<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>GifTastic - Week 6 Homework</title>
</head>

<body>

    <form>
        <input type="text" id="inputMuppet"><br><br>
        <button id="addMuppetButton">Add a Muppet</button>
    </form>

    <div id="muppetButtonDiv"></div>


    <div id="muppets-appear-here"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript">

        $(document).ready(function () {

            var topics = ["fozzy bear", "kermit", "gonzo"];

            function makeButtons() {
                
                var muppetButtonDiv = $("#muppetButtonDiv");

                for (let i = 0; i < topics.length; i++) {

                    console.log(topics);

                    var muppetButton = $("<button>");
                    //$('<input/>', { type: "button", id: "field", value: "I'm a button" });
                    muppetButton.attr("data-muppet", topics[i]);

                    muppetButton.addClass("muppet-button");

                    muppetButton.text(topics[i]);

                    $(muppetButtonDiv).append($(muppetButton));
                }
            }

            

            function addNewButton() {
                $("#addMuppetButton").on("click", function () {

                    var newMuppet = $("#inputMuppet").val().trim();
                    alert(newMuppet);
                    if (newMuppet == "") {
                        return false; // added so user cannot add a blank button
                    }
                    topics.push(newMuppet);
                    console.log(topics);
                    alert(topics);

                    makeButtons();
                    
                });
            }
            makeButtons();
            addNewButton();

            $(".muppet-button").on("click", function () { //event listener for all button elements

                var muppet = $(this).attr("data-muppet"); // this refers to button that was clicked

                var queryURL = "https://api.giphy.com/v1/gifs/search?q=" +
                    muppet + "&api_key=Xf3D1IUPSfWtbSCiPw2h98KWEyZeDbPu&limit=10";

                $.ajax({  // performs AJAX GET request
                    url: queryURL,
                    method: "GET"
                })

                    .then(function (response) { //after data comes back from API

                        var results = response.data;  //stores array of results in response variable

                        for (var i = 0; i < results.length; i++) { //loops over every result item

                            if (results[i].rating !== "r" && results[i].rating !== "pg-13") {

                                var muppetDiv = $("<div>"); //create a div for gifs

                                var rating = results[i].rating;  // store result item's rating

                                var p = $("<p>").text("Rating: " + rating); //create <p> tag with result item's rating

                                var muppetImage = $("<img>"); //creates image tag

                                muppetImage.attr("src", results[i].images.fixed_height_small.url); // give image tag a src attribute of a property pulled off of result item

                                muppetImage.attr("data-state", "animate");

                                muppetImage.attr("data-still", results[i].images.fixed_height_small_still.url);

                                muppetImage.attr("data-animate", results[i].images.fixed_height_small.url);

                                muppetImage.addClass("gif");

                                muppetDiv.append(p);
                                muppetDiv.append(muppetImage); //append paragraph and muppetImage to gifDiv just created

                                $("#muppets-appear-here").prepend(muppetDiv);
                            }
                        }

                    });

            });


            $(document).on("click", ".gif", function () {

                var state = $(this).attr("data-state");
                // If the clicked image's state is animate, update its src attribute to what its data-still value is.
                // Then, set the image's data-state to still
                // Else set src to the data-animate value
                console.log(state);

                if (state === "animate") {

                    $(this).attr("src", $(this).attr("data-still"));
                    $(this).attr("data-state", "still");
                    
                } else {

                    $(this).attr("src", $(this).attr("data-animate"));
                    $(this).attr("data-state", "animate");
                }
            });

        });
    </script>
</body>

</html>