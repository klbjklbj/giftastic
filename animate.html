<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>GifTastic - Week 6 Homework</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
        crossorigin="anonymous">


    <style>

        #muppetButtonDiv {
    margin-top:40px;
}



.muppetDiv{
    margin-top:40px;
    display:inline-block;
}
        
#muppets-appear-here {
    margin-top: 50px;
 display:inline;
}
    </style>
</head>

<body>
    <div>
        <container>
            <nav class="navbar navbar-light bg-info">
                <h2 class="text-warning">It's Time for the the Muppets!</h2>
                <form class="form-inline">
                    <input class="form-control mr-sm-2" id="inputMuppet" type="search" placeholder="Enter a Muppet's name"
                        aria-label="Search">
                    <button class="btn btn-outline-warning my-2 my-sm-0" id="addMuppetButton" type="submit">Add Muppet!</button>
                </form>
            </nav>

    </div>

    <div id="muppetButtonDiv"></div>

    <div id="muppets-appear-here"></div>

    </container>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript">

        $(document).ready(function () {

            var topics = ["Fozzy Bear", "Kermit", "Gonzo", "Waldorf & Statler", "Swedish Chef"];

            var muppetButtonDiv = $("#muppetButtonDiv");

            function makeButtons() {

                (muppetButtonDiv).empty(); // to avoid duplicating button array

                for (let i = 0; i < topics.length; i++) {

                    console.log(topics);

                    var muppetButton = $("<button>");
                    //$('<input/>', { type: "button", id: "field", value: "I'm a button" });
                    muppetButton.attr("data-muppet", topics[i]);

                    muppetButton.addClass("muppet-button");

                    muppetButton.addClass("btn-info");

                    muppetButton.text(topics[i]);

                    $(muppetButtonDiv).append($(muppetButton));
                }
            }


            $(document).on("click", "#addMuppetButton", function () {

                var newMuppet = $("#inputMuppet").val().trim();
                if (newMuppet == "") {
                    alert("Please add a muppet");
                    return false; // added so user cannot add a blank button
                }
                topics.push(newMuppet);
                console.log(topics);

                makeButtons();
                return false; // why does this allow new button to array?                               

            });

            makeButtons();

            $(document).on("click", ".muppet-button", function () { //event listener for all .muppet-button's

                var muppet = $(this).attr("data-muppet"); // this refers to button that was clicked

                var queryURL = "https://api.giphy.com/v1/gifs/search?q=" +
                    muppet + "&api_key=Xf3D1IUPSfWtbSCiPw2h98KWEyZeDbPu&limit=10";

                $.ajax({  // performs AJAX GET request
                    url: queryURL,
                    method: "GET"
                })

                    .then(function (response) { //after data comes back from API

                        var results = response.data;  //stores array of results in response variable

                        for (var i = 0; i < results.length; i++) { //loops over every result item

                            if (results[i].rating !== "r" && results[i].rating !== "pg-13") {

                                var muppetDiv = $("<div>"); //create a div for gifs


                                var rating = results[i].rating;  // store result item's rating

                                var p = $("<p>").text("Rating: " + rating); //create <p> tag with result item's rating

                                var muppetImage = $("<img>"); //creates image tag

                                muppetDiv.addClass("muppetDiv");

                                muppetImage.attr("src", results[i].images.fixed_height_small.url); // give image tag a src attribute of a property pulled off of result item

                                muppetImage.attr("data-state", "animate");

                                muppetImage.attr("data-still", results[i].images.fixed_height_small_still.url);

                                muppetImage.attr("data-animate", results[i].images.fixed_height_small.url);

                                muppetImage.addClass("gif");

                                
                                muppetDiv.append(muppetImage); 
                                muppetDiv.append(p);  //append paragraph and muppetImage to gifDiv just created

                                $("#muppets-appear-here").prepend(muppetDiv);
                            }
                        }

                    });

            });

            $(document).on("click", ".gif", function () {

                var state = $(this).attr("data-state");
                // If the clicked image's state is animate, update its src attribute to what its data-still value is.
                // Then, set the image's data-state to still
                // Else set src to the data-animate value
                console.log(state);

                if (state === "animate") {

                    $(this).attr("src", $(this).attr("data-still"));
                    $(this).attr("data-state", "still");

                } else {

                    $(this).attr("src", $(this).attr("data-animate"));
                    $(this).attr("data-state", "animate");
                }
            });


        });
    </script>
</body>

</html>